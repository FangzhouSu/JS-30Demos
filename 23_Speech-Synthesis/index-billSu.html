<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Speech Synthesis | by billSu</title>
  <link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" href="../favicon.ico">
</head>
<body>
    <style>
        body{
          margin-top: 4rem;
        }
        .billSu-header {
        /* æ”¹äº†ä¸€ä¸‹å¤´éƒ¨çš„æ ·å¼ ä¿è¯å®ƒä¸€ç›´è´´åœ¨æœ€ä¸Šé¢ */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgb(21, 21, 21);
            text-align: center;
            padding: 10px;
            color: #dde666;
            font-size: 20px;
            /* font-weight: bold; */
            z-index: 999;
        }
        .billSu-header span{
            margin: 0 5px;
        }
        .billSu-header a{
            text-decoration: none;
            color: unset;
        }
        .billSu-header a:hover{
            background-color:rgb(116, 116, 116);
        }
        button{
            margin-top: 3rem;
        }
    </style> 
  
    <div class="billSu-header">
        <span><a href="https://github.com/wesbos/JavaScript30" target="_blank">JavaScript30 çµæ„Ÿæ¥æº</a></span>
        <span>|</span>
        <span><a href="https://github.com/FangzhouSu/JS-30Demos" target="_blank">æœ¬é¡¹ç›®ä»“åº“-billSU</a></span>
        <span>|</span>
        <span><a href="https://blog.csdn.net/qq_45704942?spm=1010.2135.3001.5421&type=blog" target="_blank">äº†è§£æˆ‘</a></span>
    </div>

    <div class="voiceinator">
      
      <h1>The Voiceinator 5000</h1>
      <!-- é€‰æ‹©è¯­è¨€ -->
      <select name="voice" id="voices">
        <option value="">Select A Voice</option>
      </select>
      <!-- è¯­é€Ÿå’ŒéŸ³è°ƒçš„è°ƒèŠ‚ -->
      <label for="rate">Rate:</label>
      <input name="rate" type="range" min="0" max="3" value="1" step="0.1">

      <label for="pitch">Pitch:</label>
      <input name="pitch" type="range" min="0" max="2" step="0.1">

      <!-- å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†ä¸­çš„å†…å®¹å°†è¢«è¯»å‡ºæ¥ -->
      <textarea name="text">Hello! I love JavaScript ğŸ‘</textarea>
      <button id="stop">Stop!</button>
      <button id="speak">Speak</button>

    </div>

<script>
  // 01 å–å¾—é¡µé¢å…ƒç´  
  const msg = new SpeechSynthesisUtterance();
  let voices = [];
  const voicesDropdown = document.querySelector('[name="voice"]');
  const options = document.querySelectorAll('[type="range"], [name="text"]');
  const speakButton = document.querySelector('#speak');
  const stopButton = document.querySelector('#stop');
  // 02 è·å–å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†ä¸­çš„å†…å®¹,å°†è¿™äº›å†…å®¹èµ‹ç»™SpeechSynthesisUtteranceå¯¹è±¡
  msg.text = document.querySelector('[name="text"]').value

  // 03 è·å–æ”¯æŒè¯­è¨€å¹¶æ·»åŠ è‡³ä¸‹æ‹‰åˆ—è¡¨
  function populateVoices(){
    voices = this.getVoices();
    console.log(voices);// æ‰“å°å‡ºæ¥æ”¯æŒçš„æ‰€æœ‰è¯­è¨€
    // å°†æ‰€æœ‰è¯­ç³»æ”¾åˆ°ä¸‹æ‹‰é€‰å•voicesDropdownä¸­
    voicesDropdown.innerHTML = voices
      // ä½¿ç”¨filterç­›é€‰å‡ºåŒ…å«zhä»¥åŠençš„è¯­ç³»
      .filter(voice => voice.lang.includes('zh') || voice.lang.includes('en'))
      // ç­›é€‰åçš„arrayé€è¿‡mapæŠŠèµ„æ–™ç»„æˆhtml
      .map(voice => `<option value=${voice.name}>${voice.name}(${voice.lang})</option>`)
      // ç”¨joinæ¥åˆå¹¶ä¸”æ¶ˆé™¤åŸæœ¬æ•°ç»„çš„é€—å·
      .join('')
  }

  // 03 åˆ‡æ¢æ’­æ”¾
  function toggle(starOver = true){
    speechSynthesis.cancel();
    if(starOver){
      speechSynthesis.speak(msg);
    }
  }

  // 04 è®¾å®šé€‰æ‹©çš„å‘éŸ³è¯­è¨€
  function setVoice(){
    msg.voice = voices.find(voice => voice.name === this.value);
    toggle();
  }

  // 05 è®¾å®šè¯­é€Ÿå’ŒéŸ³è°ƒ
  function setOption(){
    console.log("xx");
    // ä¼ å…¥çš„å‚æ•°åç§°ä¸SpeechSynthesisUtteranceæœ¬èº«çš„ç‰©ä»¶ç›¸åŒ
    // æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨setOptionæ¥è®¾å®šå®ä¾‹å¯¹è±¡msgçš„é€Ÿç‡&éŸ³è°ƒ
    msg[this.name] = this.value;
    console.log(this.name,this.value);
    toggle();
   
  }

  // 06 ç›‘å¬äº‹ä»¶å‘ç”Ÿå¹¶è°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•°
    // ç›‘å¬è¯­è¨€æ¸…å•çš„å˜æ›´ï¼Œæ›´æ–°è¯­ç³»æ¸…å•
  speechSynthesis.addEventListener('voiceschanged', populateVoices);
    // ç›‘å¬è¯­ç³»é€‰å•ï¼Œé€‰æ‹©åè°ƒç”¨setVoiceé€‰æ‹©å‘éŸ³çš„è¯­è¨€
  voicesDropdown.addEventListener('change', setVoice);
    // ç›‘å¬é€Ÿç‡&éŸ³è°ƒçš„æ§åˆ¶æ¡ï¼ˆtype=rangeï¼‰æ‹–åŠ¨æ§åˆ¶æ¡åå®æ—¶è¿›è¡Œè®¾å®š
  options.forEach(option => option.addEventListener('change', setOption));
    // æ’­æ”¾æŒ‰é’®
  speakButton.addEventListener('click', toggle);
    // åœæ­¢æŒ‰é’®
  stopButton.addEventListener('click', () => toggle(false));

</script>

</body>
</html>
